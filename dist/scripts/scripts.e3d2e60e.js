"use strict";var ngOpenmrsApp=angular.module("ngOpenmrsApp",["ui.router","defaulterCohort","openmrs.auth","openmrs.formentry","openmrsServices","flex","patientSearch","patientDashboard","spinner"]);ngOpenmrsApp.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b){a.state("login",{url:"/login",templateUrl:"views/auth/login.html"}).state("logout",{url:"/logout",templateUrl:"views/auth/login.html"}).state("apps",{url:"/apps",templateUrl:"views/apps.html",authenticate:!0}).state("patient-search",{url:"/patient-search",templateUrl:"/views/patient-search/patient-search.html",controller:"PatientSearchCtrl",authenticate:!0}).state("patient",{url:"/patient/:uuid",templateUrl:"views/patient-dashboard/patient-dashboard.html",controller:"PatientDashboardCtrl",authenticate:!0}).state("defaulter-cohort",{url:"/defaulter-cohort",templateUrl:"views/defaulter-cohort/defaulter-cohort.html",controller:"DefaulterCohortCtrl",authenticate:!0}).state("encounter-form",{url:"/encounter-form?formUuid&patientUuid&savedFormId",authenticate:!0,templateProvider:["$stateParams","FormEntryService","$templateFactory",function(a,b,c){var d=b.getTemplate(a.formUuid),e=c.fromUrl(d);return e}]}).state("encounter-forms-saved",{url:"/encounter-forms-saved",templateUrl:"views/formentry/encounter-forms-saved.html",authenticate:!0}).state("formentry",{url:"/formentry?encounterUuid&formUuid&patientUuid",authenticate:!0,templateProvider:["$stateParams","FormEntryService","$templateFactory",function(a,b,c){var d=b.getTemplate(a.formUuid),e=c.fromUrl(d);return e}]}),b.otherwise("/apps")}]).run(["$rootScope","$state","Auth","OpenmrsFlexSettings","DefaulterCohortService","FormEntryService",function(a,b,c,d,e,f){a.$on("$stateChangeStart",function(a,d){d.authenticate&&!c.isAuthenticated()&&(b.transitionTo("login"),a.preventDefault()),"/logout"==d.url&&c.logout()}),a.servicesWithUserData=["OpenmrsFlexSettings","FormEntryService","DefaulterCohortService"],d.init(),e.init(),f.init()}]);var formEntry=angular.module("openmrs.formentry",["openmrsServices","flex","localStorageServices","spinner"]);formEntry.factory("FormEntryService",["Auth","localStorage.utils","Flex","EncounterService","PersonAttributeService","ObsService","PatientService",function(a,b,c,d,e,f,g){function h(a){var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;d>b;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e}function i(a,b,c){var d,e=!1;for(var f in a)if(d=a[f],null!==d)if("obs"in d){var g={concept:d.concept,groupMembers:[]},h=i(d.obs,g.groupMembers,null);h&&(g.groupMembers.length>0&&b.push(g),d.uuid&&c.push({uuid:d.uuid}))}else null!==c&&d.existingValue?d.value!=d.existingValue&&c.push({concept:d.concept,value:d.value,uuid:d.uuid}):null!==d.value&&void 0!==d.value&&(d.existingValue&&d.existingValue!=d.value?e=!0:void 0===d.existingValue&&""!==d.value.toString().trim()&&(e=!0),""!==d.value.toString().trim()&&b.push({concept:d.concept,value:d.value}));return e}function j(b){var d,f,h=b.patient.getAttributes()||[],i=b.personAttributes,j=[],k=b.patient.getUuid();for(var l in i)if("oldPersonAttributes"!==l){d=!0;for(var m in h)if(f=h[m].attributeType.uuid,l===f){i[l]===h[m].value&&(console.log("attribute has not changed"),d=!1);break}d&&j.push({attributeType:l,value:i[l]})}for(var m in j)e.save(k,j[m].attributeType,j[m].value,function(a){console.log(a)});b.patient.setAttributes(b.personAttributes),c.save(g,k,b.patient,a.getPassword())}function k(a){var b=[],c=[];i(a.obs,b,c);var d={uuid:a.encounter.uuid,patient:a.encounter.patient,encounterDatetime:a.encounter.encounterDatetime,encounterType:a.encounter.encounterType,location:a.encounter.location,provider:a.encounter.provider,form:a.encounter.form,obs:b,obsToUpdate:c};return d}var l={},m="openmrs.formentry.pending-submission",n="openmrs.formentry.drafts",o=[m,n,"openmrs.formentry.saved-user-data"];l.init=function(){b.init(o)},l.initUser=function(c){var d={"openmrs.formentry.pending-submission":b.getAll(m,a.getPassword()),"openmrs.formentry.drafts":b.getAll(n,a.getPassword())};b.set("openmrs.formentry.saved-user-data",c,d,a.getPassword());var e=b.get("openmrs.formentry.saved-user-data",c,a.getPassword());b.setAll("openmrs.formentry.pending-submission",e["openmrs.formentry.pending-submission"],function(a){return a.savedFormId},a.getPassword()),b.setAll("openmrs.formentry.drafts",e["openmrs.formentry.drafts"],function(a){return a.savedFormId},a.getPassword()),b.remove("openmrs.formentry.saved-user-data",c)};var p={"1eb7938a-8a2a-410c-908a-23f154bf05c0":{name:"Outreach Follow-up Form",template:"/views/formentry/forms/outreach-form2.html",encounterType:"df5547bc-1350-11df-a1f1-0026b9348838"}};return l.getTemplate=function(a){return p[a].template},l.getEncounterType=function(a){return p[a].encounterType},l.getForms=function(){return p},l.getDrafts=function(c){if(c){var d=b.get(n,c,a.getPassword());return d?d:null}return b.getAll(n,a.getPassword())},l.removeFromDrafts=function(a){b.remove(n,a)},l.saveToDrafts=function(c){if(void 0===c.savedFormId){var d=JSON.stringify(c);c.savedFormId=h(d)}else l.removeFromPendingSubmission(c.savedFormId);b.set(n,c.savedFormId,c,a.getPassword())},l.getPendingSubmission=function(c,d){if(c){var e=b.get(m,c,a.getPassword());if(!d)return e;d(e)}else{var f=b.getAll(m,a.getPassword());if(!d)return f;d(f)}},l.removeFromPendingSubmission=function(a){b.remove(m,a)},l.saveToPendingSubmission=function(c,d){if(console.log("saveToPendingSubmission()..."),console.log(c),!c.savedFormId){var e=JSON.stringify(c);c.savedFormId=h(e)}c.personAttributes=d,b.set(m,c.savedFormId,c,a.getPassword())},l.submit=function(a){console.log("FormEntryService.submit() : submitting encounter");var b=k(a),e=b.obsToUpdate;delete b.obsToUpdate,d.submit(b,function(g){return a.savedFormId&&l.removeFromDrafts(a.savedFormId),void 0===g||null===g||g.error?(console.log("FormEntryService.submit() : error submitting. Saving to local"),a.restObs=b.obs,a.obsToUpdate=e,l.saveToPendingSubmission(a)):(c.remove(d,a.encounter.uuid),void 0!==a.savedFormId&&l.removeFromPendingSubmission(a.savedFormId),e.length>0&&f.updateObsSet(e,function(a){console.log(a)}),j(a)),g})},l.submitPendingSubmission=function(){var a=l.getPendingSubmission();for(var b in a){var c=a[b];l.submit(c)}},l}]);var auth=angular.module("openmrs.auth",["ngResource","openmrsServices"]);auth.factory("Auth",["$injector","$rootScope","Base64","$http","$location","OpenmrsSessionService","OpenmrsUserService",function(a,b,c,d,e,f,g){function h(){var a=CryptoJS.lib.WordArray.random(16);return localStorage.setItem("openmrs.auth.salt",a),a}function i(){var a=localStorage.getItem("openmrs.auth.salt");return null===a&&(a=h()),a}function j(a){var b=i(),c=CryptoJS.PBKDF2(a,b,{keySize:4,iterations:100});return c}function k(a,b){var c=l(a);if(c){var d=j(b).toString();return d===c.password}return void 0}function l(a){var b=angular.fromJson(localStorage.getItem("openmrs.users")),c=b[a];return void 0===c?void 0:angular.fromJson(c)}function m(a,b){var c=j(b).toString(),d=angular.fromJson(localStorage.getItem("openmrs.users"));null===d&&(d={}),d[a]=angular.toJson({username:a,password:c.toString()}),localStorage.setItem("openmrs.users",angular.toJson(d))}var n={};return n.authenticated=null,n.setAuthenticated=function(a){this.authenticated=a},n.isAuthenticated=function(){return this.authenticated},n.setPassword=function(a){this.curPassword=a},n.getPassword=function(){return this.curPassword},n.authType=null,n.setAuthType=function(a){this.authType=a},n.getAuthType=function(){return this.authType},n.setCredentials=function(a,b){var e=c.encode(a+":"+b);d.defaults.headers.common.Authorization="Basic "+e},n.clearCredentials=function(){document.execCommand("ClearAuthenticationCache"),d.defaults.headers.common.Authorization="Basic "},n.initUser=function(c){var d=b.servicesWithUserData;for(var e in d){var f=a.get(d[e]);f.initUser(c)}},n.hasRole=function(a,b){var c=sessionStorage.getItem("username");g.hasRole(c,a,function(a){b&&b(a)})},n.getRoles=function(a){var b=sessionStorage.getItem("username");console.log("getting roles for "+b),g.getRoles(b,function(b){a&&a(b)})},n.authenticateLocal=function(a,b,c){console.log("Auth.authenticateLocal() : authenticating locally"),n.setAuthType("local");var d=k(a,b);d?(console.log("Authenticated: true"),n.setAuthenticated(!0),n.setPassword(b),n.clearCredentials(),e.path("/apps")):(console.log("Local password does not match"),n.setAuthenticated(!1),n.setPassword(null),c(!1))},n.authenticate=function(a,b,c){console.log("Auth.authenticateRemote() : authenticate on server"),n.setAuthType("remote"),n.setCredentials(a,b),f.getSession(function(d){if(d.online)if(d.authenticated){var f=k(a,b);(void 0===f||f===!1)&&n.initUser(a),m(a,b),n.setAuthenticated(!0),n.setPassword(b),e.path("/apps")}else n.setAuthenticated(!1),n.setPassword(null),c(!1);else n.authenticateLocal(a,b,c)})},n.logout=function(){n.clearCredentials(),f.logout(),n.setPassword(null),n.setAuthenticated(!1)},n}]),auth.factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}});var auth=angular.module("openmrs.auth");auth.controller("LoginCtrl",["$scope","Auth",function(a,b){a.username="",a.password="",a.errors="",a.authenticate=function(){b.authenticate(a.username,a.password,function(b){b||(a.errors="Username and password do not match. Please try again."),console.log("errors: "+a.errors)})}}]);var session=sessionStorage,DEFAULTER_COHORT_CONTEXT="https://testserver1.ampath.or.ke",dc=angular.module("defaulterCohort",["ngResource","ngCookies","openmrsServices","spinner","localStorageServices"]);dc.factory("DefaulterCohort",["$resource",function(a){return a(DEFAULTER_COHORT_CONTEXT+"/outreach/ajax_get_defaulter_cohort",{query:{method:"GET",isArray:!1}})}]),dc.factory("DefaulterCohortService",["$http","spinnerService","localStorage.utils","Auth","DefaulterCohort","EncounterService","PatientService",function(a,b,c,d,e,f,g){var h={};return h.ping=function(){a.get(DEFAULTER_COHORT_CONTEXT).success(function(a){console.log(a)})},h.init=function(){var a=["defaulter-cohort","defaulter-cohorts","outreach-providers"];c.init(a),h.getOutreachProviders()},h.initUser=function(){var a=["defaulter-cohort"];c.reset(a)},h.get=function(a,f){b.show("waiting"),void 0===a||""===a?a=session.getItem("curDefaulterCohortUuid"):session.setItem("curDefaulterCohortUuid",a);var g=c.get("defaulter-cohort",a,d.getPassword());g?(f(g),b.hide("waiting")):void 0!==a&&""!==a&&(console.log("Getting defaulter cohort from server..."),e.get({defaulter_cohort_uuid:a},function(b){c.set("defaulter-cohort",a,b.defaulter_cohort,d.getPassword());var e=[],g=b.defaulter_cohort.patients;for(var i in g)e.push(g[i].uuid);return h.getMemberData(e),f?f(b):b},function(a){f({online:!1,error:a})})),b.hide("waiting")},h.getMemberData=function(a){var b,e;for(var h in a)b=a[h],e={startIndex:0,patient:b},g.get(b,function(a){a.error?console.log("patient not found"):f.patientQuery(e,function(b){a.encounters=b,c.set("openmrs.patient",a.uuid,a,d.getPassword())})})},h.getDefaulterCohorts=function(b){var d=c.getAll("defaulter-cohorts");0!=Object.keys(d).length?(console.log("getting defaulter cohorts from local"),b(d)):(console.log("getting defaulter cohorts from server"),a.get(DEFAULTER_COHORT_CONTEXT+"/outreach/ajax_get_defaulter_cohorts").success(function(a){console.log(a),console.log(typeof a),c.setAll("defaulter-cohorts",a,function(a){return"0"!==a.uuid?a.uuid:a.id}),b(a)}).error(function(a,b){alert("error"),alert(a),alert(b)}))},h.update=function(b,e){console.log("updateDefaulterCohort() : updating cohort...");var f,g=0;if(navigator.onLine){var i=DEFAULTER_COHORT_CONTEXT+"/outreach/ajax_get_retired_members?defaulter_cohort_uuid="+b;a.get(i).success(function(a){if(-1!=a.indexOf("*"))h.get(b,e);else{f=c.get("defaulter-cohort",b,d.getPassword());for(var i=0;i<a.length;i++){var j=a[i];if(j in f.patients){var k=f.patients[j];0==k.retired&&(f.patients[j].retired=1,g++)}}c.setItem("defaulter-cohort",b,f,d.getPassword()),e(g)}})}},h.getNew=function(b,e){c.removeItem("defaulter-cohort",b);var f=DEFAULTER_COHORT_CONTEXT+"/outreach/ajax_get_new_defaulter_cohort?defaulter_cohort_uuid="+b;a.get(f).success(function(a){c.set("defaulter-cohorts",a.defaulter_cohorts),c.set("defaulter-cohort",a.defaulter_cohort.uuid,a.defaulter_cohort,d.getPassword()),e(a.defaulter_cohort)})},h.getOutreachProviders=function(b){var d=DEFAULTER_COHORT_CONTEXT+"/outreach/ajax_get_outreach_providers",e=c.getAll("outreach-providers");if(void 0===e||null===e)console.log("Getting outreach providers from server"),a.get(d).success(function(a){console.log("got outreach providers"),c.setAll("outreach-providers",a,function(a){return a.uuid}),e=a,b&&b(e)}).error(function(a){console.log(a)});else{if(!b)return e;b(e)}},h}]);var dc=angular.module("defaulterCohort");dc.controller("DefaulterCohortCtrl",["$scope","$http","Auth","DefaulterCohortService",function(a,b,c,d){function e(){var b=0;for(var c in a.defaulterCohort.patients)a.defaulterCohort.patients[c].retired&&b++;a.numRetired=b}a.defaulterCohorts="",a.defaulterCohortUuid="",a.defaulterCohort={},a.numRetired=0,a.riskCategories={0:"Being Traced",1:"High",2:"Medium",3:"Low",4:"LTFU",5:"no_rtc_date",6:"Untraceable"},a.outreachProviders=d.getOutreachProviders(),a.getDefaulterCohort=function(){var b=sessionStorage.getItem("curDefaulterCohortUuid");if(void 0===a.defaulterCohortUuid||null===a.defaulterCohortUuid||""===a.defaulterCohortUuid){if(!b)return;a.defaulterCohortUuid=b}console.log("Getting defaulter cohort..."),d.get(a.defaulterCohortUuid,function(b){return b.online===!1?void alert("You must be online to download this cohort."):(a.defaulterCohort=b,b.uuid!=a.defaulterCohortUuid&&d.getDefaulterCohorts(function(c){a.defaulterCohorts=c,a.defaulterCohortUuid=b.uuid}),void e())})},a.getDefaulterCohort(),a.updateDefaulterCohort=function(){""!=a.defaulterCohortUuid&&d.update(a.defaulterCohortUuid,function(b){"number"==typeof b?(alert(b+" patients retired."),e()):a.defaulterCohort=b})},a.getNewDefaulterCohort=function(){""!=a.defaulterCohortUuid&&confirm("This will retire the current list. Are you sure you want to create a new defaulter list?")&&d.getNew(a.defaulterCohortUuid,function(b){a.defaulterCohort=b,e(),d.getDefaulterCohorts(function(b){a.defaulterCohorts=b})})},d.getDefaulterCohorts(function(b){a.defaulterCohorts=b})}]);var flex=angular.module("flex",["ngResource","ngCookies","openmrsServices","openmrs.auth","localStorageServices"]);flex.factory("OpenmrsFlexSettings",["localStorage.utils",function(a){var b={};return b.init=function(){var b=["openmrs.patient","expiration","openmrs.provider","openmrs.location","openmrs.encounter","openmrs.users"];a.init(b)},b.initUser=function(){var b=["openmrs.patient","openmrs.encounter"];a.reset(b)},b}]),flex.factory("Flex",["localStorage.utils",function(a){function b(b,c,d,e,f){b.get(c,function(g){if(d){var h="openmrs."+b.getName();a.set(h,c,g,e)}return f?void f(g):g})}function c(b,c,d,e,f){b.getAll(function(g){if(d){var h="openmrs."+b.getName();a.setAll(h,g,c,e)}f&&f(g)})}function d(b,c,d,e,f,g,h){b.query({q:c},function(c){if(e){var h="openmrs."+b.getName();a.setQuerySet(h,c,d,f)}g&&g(c)},function(a){h(a)})}var e={};return e.getFromServer=function(a,c,d,e,f){b(a,c,d,e,f)},e.getFromLocal=function(b,c,d,e,f){var g="openmrs."+b.getName(),h=a.get(g,c,e);f(h)},e.get=function(c,d,e,f,g){var h="openmrs."+c.getName(),i=a.get(h,d,f);i?g(i):b(c,d,e,f,g)},e.query=function(b,c,e,f,g,h){{var i="openmrs."+b.getName();d(b,c,e,f,g,h,function(b){if(b.online===!1){console.log("searching locally");var d=a.query(i,null,c,g);h(d)}})}},e.getAll=function(b,d,e,f,g){var h="openmrs."+b.getName(),i=a.getAll(h);Object.keys(i).length>0?g(i):c(b,d,e,f,g)},e.remove=function(b,c,d){var e="openmrs."+b.getName();a.remove(e,c),d&&d()},e.save=function(b,c,d,e,f){var g="openmrs."+b.getName();a.set(g,c,d,e),f&&f()},e}]);var formEntry=angular.module("openmrs.formentry");formEntry.controller("SavedFormsCtrl",["$scope","$stateParams","FormEntryService","Auth","Flex","PatientService",function(a,b,c,d,e,f){a.loadDrafts=function(){var b=c.getDrafts();for(var d in b)b[d].patient=f.Patient(b[d].patient.patientData);a.savedDrafts=b},a.loadPendingSubmission=function(){var b=c.getPendingSubmission();for(var d in b){var e=b[d].patient;a.loadPatient(e,b[d])}a.pendingSubmission=b},a.submitPendingSubmission=function(){c.submitPendingSubmission()},a.loadDrafts(),a.loadPendingSubmission()}]),formEntry.controller("FormEntryCtrl",["$scope","$stateParams","Auth","Flex","EncounterService","PatientService","FormEntryService","spinnerService",function(a,b,c,d,e,f,g){if(a.patientUuid=b.patientUuid,d.get(f,b.patientUuid,!0,c.getPassword(),function(b){a.patient=f.Patient(b.patientData)}),b.savedFormId){var h=g.getDrafts(b.savedFormId);null===savedFrom&&(h=g.getPendingSubmission(b.savedFormId)),a.form=form}else if(b.encounterUuid)a.encounterUuid=b.encounterUuid,d.get(e,b.encounterUuid,!0,c.getPassword(),function(b){a.existingEncounter=b});else{var i=new Date;a.encounter={patient:a.patientUuid,form:b.formUuid,encounterType:g.getEncounterType(b.formUuid),isNewEncounter:!0,encounterDatetime:i.toISOString()}}}]);var formEntry=angular.module("openmrs.formentry");formEntry.directive("htmlForm",["$parse","$compile","$state","FormEntryService",function(a,b,c,d){return{restrict:"E",scope:!1,controller:["$scope",function(b){b.id=0,b.obsCount=0,b.form={patient:b.patient},this.getId=function(){return b.id++},this.getObs=function(){return b.form.obs},this.getFormScope=function(){return b},this.setObs=function(c){var d=a(c).assign;d(b,d)},this.addToModel=function(c,d,e){var f=a(c)(b);if(void 0===f)b.obs=[],f=b.obs;else if(f[d])return;f[d]=e}}],link:function(a){function b(){var a=$("form").valid();return a}a.saveToDrafts=function(){alert("This feature is currently unavailable.")},a.submit=function(){b()&&(d.submit(a.form),c.go("patient",{uuid:a.patient.getUuid()}))}}}}]).directive("patientDemographics",[function(){return{restrict:"E",scope:{patient:"="},link:function(){},templateUrl:"views/formentry/patient-demographics.html"}}]).directive("clinicLocationsDropdown",["LocationService","Flex",function(){return{restrict:"EA",scope:{model:"=",label:"@",name:"@"},controller:["$scope","LocationService","Flex",function(a,b,c){c.getAll(b,function(a){return a.uuid},!0,null,function(b){a.locations=b})}],templateUrl:"views/formentry/locations.html"}}]).directive("providersDropdown",["ProviderService","Flex",function(){return{restrict:"E",scope:{model:"=",label:"@",name:"@"},controller:["$scope","ProviderService","Flex",function(a,b,c){c.getAll(b,function(a){return a.uuid},!0,null,function(b){a.providers=b})}],templateUrl:"views/formentry/providersDropdown.html"}}]).directive("outreachProvidersDropdown",["DefaulterCohort",function(a){return{restrict:"E",scope:{model:"=",label:"@",name:"@"},controller:["$scope","ProviderService","Flex",function(b){a.getOutreachProviders(function(a){b.outreachProviders=a})}],templateUrl:"views/formentry/outreachProvidersDropdown.html"}}]).directive("encounter",["$parse","$compile",function(){return{restrict:"E",scope:!1,require:"^htmlForm",link:function(a){function b(b){a.form.encounter=b}function c(b){a.form.encounter={uuid:b.uuid,patient:b.patient.uuid,encounterDatetime:b.encounterDatetime,encounterType:b.encounterType.uuid,location:b.location.uuid,provider:b.provider.uuid,form:b.form.uuid}}a.$watch("encounter",function(c){void 0!==c&&null!==c&&""!==c&&(c.savedFormId?b(c):c.isNewEncounter&&(a.form.encounter=c))}),a.$watch("existingEncounter",function(a){void 0!==a&&null!==a&&""!==a&&c(a)})}}}]).directive("obsGroup",["$parse","$compile",function(a,b){return{restrict:"E",scope:{},transclude:!0,replace:!0,require:"^htmlForm",link:function(c,d,e,f,g){function h(b,e){var f;e.each(function(){if(void 0===this)return!1;var e,g,i,k,l,m,n=this.attributes["concept-uuid"].value;for(var o in b)if(f=b[o],f.concept.uuid===n&&!f.isLoaded){if(e=this.attributes.lineage.value,g=a(e)(j),i=a(e).assign,g.value||g.obs){c.getClone();break}f.isLoaded=!0,f.value?(k=getValue(f),l=f.exitingValue||f.value,i(j,{concept:n,value:k,uuid:f.uuid,existingValue:l})):f.groupMembers&&(m=$(d).find("obs, obsGroup"),i(j,{concept:n,uuid:f.uuid,obs:[]}),h(f.groupMembers,m));break}})}var i=f.getId(),j=f.getFormScope(),k=e.conceptUuid,l=angular.element(d).parent().attr("lineage");void 0===l||null===l?l="form.obs":l+=".obs",void 0===a(l)(j)&&(j.form.obs=[]);var m=l+"["+i+"]";if(d.attr("lineage",m),f.addToModel(l,i,{concept:k,obs:[]}),g(c,function(a,c){if(d[0].attributes.repeat){var e=angular.element("<button ng-click='getClone()'>Repeat</button><br/>");b(e)(c),d.before(e)}d.append(a)}),d[0].attributes.repeat){var n=d.clone();n.removeAttr("lineage class repeat"),n.find("*").removeAttr("lineage class"),n.find("select").attr("obs",""),c.template=n[0].outerHTML,c.$parent.templates[m]=n[0].outerHTML}c.getClone=function(){var a=b(c.template)(c);d.append("<br/>"),d.after(a)};var l=d.parent().attr("lineage");void 0===l&&j.$watch("existingEncounter",function(a){a&&h(a.obs,d)})}}}]).directive("obs",["$parse","$compile",function(a,b){return{restrict:"E",scope:!0,priority:1e5,require:"^htmlForm",link:function(c,d,e,f){function g(){var e=(d[0].outerHTML,d.find("select,input"));e.attr("ng-model","selected"),"checkbox"===e.attr("type")&&(l=e.attr("value")),b(e)(c);var g=f.getId(),h=angular.element(d).parent().attr("lineage");void 0===h||null===h?h="form.obs":h+=".obs",void 0===a(h)(n)&&(n.form.obs=[]),k=h+"["+g+"]",d.attr("lineage",k),f.addToModel(h,g,m)}function h(b){if(void 0!==b){var c=a(k)(n),d=a(k);c.value=l?b===!0?l:"":b,d(n,c)}}function i(a){if(a.value){var b=a.value;return"[object Object]"==Object.prototype.toString.call(b)&&(b=a.value.uuid),b}return void 0}function j(e,f){var g,h,j,k,m,o,p,q;f.each(function(){if(void 0===this)return!1;h=this.attributes["concept-uuid"].value;for(var f in e)if(g=e[f],p=i(g),g.concept.uuid===h&&!(l&&d.find("input").attr("value")!==p||g.isLoaded)){if(j=this.attributes.lineage.value,k=a(j)(n),m=a(j).assign,k.value){o=angular.element(d.outerHTML),d.after(o),b(o)(c);break}g.isLoaded=!0,p&&(q=g.existingValue||p,m(n,{concept:h,value:p,uuid:g.uuid,existingValue:q}),l?(d.find("input").attr("checked",!0),c.selected=!0):c.selected=p);break}})}var k,l,m={concept:e.conceptUuid},n=f.getFormScope();g(),c.$watch("selected",function(a){"[object Date]"===Object.prototype.toString.call(a)&&(a=a.toISOString(),c.selected=a),h(a)});var o=d.parent().attr("lineage");void 0===o&&n.$watch("existingEncounter",function(a){a&&j(a.obs,d)})}}}]).directive("personAttribute",["$parse","$compile",function(a,b){return{restrict:"E",scope:!0,priority:1e5,require:"^htmlForm",link:function(a,c,d,e){function f(){var d=c.find("select,input");d.attr("ng-model","selected"),"checkbox"===d.attr("type")&&(h=d.attr("value")),b(d)(a),void 0===i.form.personAttributes&&(i.form.personAttributes={}),e.addToModel("personAttributes",j,"")}function g(a){void 0!==a&&("[object Date]"===Object.prototype.toString.call(a)&&(a=a.toISOString()),i.form.personAttributes[j]=a)}var h,i=e.getFormScope(),j=d.uuid;f(),a.$watch("selected",function(a){g(a)}),i.$watch('form.personAttributes["'+j+'"]',function(b){h?(c.find("input").attr("checked",!0),a.selected=!0):a.selected=b}),i.$watch("patient",function(){var b,c=a.patient.patientData.person.attributes;for(var d in c)if(b=c[d],j===b.attributeType.uuid){a.selected=b.value;break}})}}}]);var localStorageServices=angular.module("localStorageServices",[]);localStorageServices.factory("localStorage.utils",[function(){function a(a){return angular.fromJson(localStorage.getItem(a))}function b(a,b){localStorage.setItem(a,angular.toJson(b))}function c(a,b){return CryptoJS.Rabbit.encrypt(a,b).toString()}function d(a,b){return CryptoJS.Rabbit.decrypt(a,b).toString(CryptoJS.enc.Utf8)}function e(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var f={};return f.init=function(a){var b,c;for(var d in a)b=a[d],c=localStorage.getItem(b),(void 0===c||null===c)&&localStorage.setItem(b,"{}")},f.reset=function(a){var b,c;for(var d in a)b=a[d],c=localStorage.setItem("defaulterCohorts","{}")},f.setExpirationDate=function(c,d,e){var f=7,g=a("expiration"),h=c+"##"+d,i=new Date;i.setDate(e?i.getDate()+e:i.getDate()+f);var j=i.toISOString().substring(0,10),k=[h];j in g?(k=g[j],k.push(h)):g[j]=k,b("expiration",g)},f.removeExpired=function(c){var d=a("expiration"),e={};c||(c=(new Date).toISOString().substring(0,10));var f=d[c];for(var g in f){var h,i=g.split("##"),j=i[0],k=i[1];j in e?h=e[j]:(h=a(j),e[j]=h),delete h[k]}for(var h in e)b(h,e[h]);delete d[k]},f.remove=function(c,d){var e=a(c);delete e[d],b(c,e)},f.get=function(b,c,e){console.log("LocalStorageServices.get() : table: "+b+" key: "+c);var f=a(b);if(c in f){var g=f[c];return e&&(g=d(g,e)),g=angular.fromJson(g)}return null},f.getAll=function(b,c){var e=a(b),f=new Array;for(var g in e){var h=e[g];c&&(h=d(h,c)),h=angular.fromJson(h),f.push(h)}return f},f.set=function(d,e,g,h){var i=a(d);g=angular.toJson(g),h&&(g=c(g,h)),i[e]=g,b(d,i),f.setExpirationDate(d,e)},f.setQuerySet=function(b,d,e,f){var g=a(b);for(var h in d){var i=d[h],j=e(i);i=angular.toJson(i),f&&(i=c(i,f)),g[j]=i}},f.setAll=function(a,b,d,e){var f={};for(var g in b){var h=d(b[g]),i=angular.toJson(b[g]);e&&(i=c(i,e)),f[h]=i}localStorage.setItem(a,angular.toJson(f))},f.query=function(b,c,f,g){var h,i,j=a(b),k=[],l=new RegExp(f);for(var m in j)if(h=j[m],g&&(h=d(h,g)),c){h=angular.fromJson(h);for(var n in c)if(i=c[n],l.test(e(h[i]))){k.push(h);break}}else l.test(e(h))&&k.push(h);return k},f}]);var openmrsServices=angular.module("openmrsServices",["ngResource","ngCookies"]),OPENMRS_CONTEXT_PATH="http://etl1.ampath.or.ke:8080/amrs";openmrsServices.factory("OpenmrsUtilityService",[function(){var a={};return a.getParam=function(a,b){for(var c=a.substring(a.indexOf("?")).split("&"),d=0;d<c.length;d++){var e=c[d],f=e.split("=");if(f[0]==b)return f[1]}return void 0},a.getStartIndex=function(a){var b=void 0;if(a.links)for(var c in a.links){var d=a.links[c];if("next"==d.rel){b=this.getParam(d.uri,"startIndex");break}}return b},a}]),openmrsServices.factory("openmrs",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/:object/:uuid",{object:"@object",uuid:"@uuid"},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("interceptor",["$q",function(){return{request:function(a){return a},requestError:function(a){alert("requestError"),alert(a)},response:function(a){return a},responseError:function(a){alert("responseError"),alert(angular.toJson(a,!0))}}}]),openmrsServices.config(["$httpProvider",function(){}]),openmrsServices.factory("OpenmrsSession",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/session",{})}]),openmrsServices.factory("OpenmrsSessionService",["OpenmrsSession",function(a){var b={};return b.getSession=function(b){return a.get({},function(a){console.log(a),a.online=!0,b(a)},function(a){b({online:!1,error:a})})},b.logout=function(){return a["delete"]({},function(){})},b}]),openmrsServices.factory("Person",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/person/:uuid",{uuid:"@uuid"},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("Provider",["$resource",function(a){var b="custom:(uuid,identifier,person:ref)";return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/provider/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("ProviderService",["Provider",function(a){var b={};return b.getName=function(){return"provider"},b.getAll=function(b){a.query().$promise.then(function(a){b(a.results)},function(a){b({online:!1,error:a})})},b}]);var Patient=function(a){this.patientData=a};Patient.prototype.getPatient=function(){return this.patientData},Patient.prototype.getUuid=function(){return this.patientData.uuid},Patient.prototype.getName=function(){return(this.patientData.person.preferredName.givenName||"")+" "+(this.patientData.person.preferredName.middleName||"")+" "+this.patientData.person.preferredName.familyName},Patient.prototype.getGivenName=function(){return this.patientData.person.preferredName.givenName},Patient.prototype.setGivenName=function(a){return this.patientData.person.preferredName.givenName=a},Patient.prototype.getFamily=function(){return this.patientData.person.preferredName.familyName},Patient.prototype.setFamilyName=function(a){return this.patientData.person.preferredName.familyName=a},Patient.prototype.getMiddleName=function(){return this.patientData.person.preferredName.middleName},Patient.prototype.setMiddleName=function(a){return this.patientData.person.preferredName.middleName=a},Patient.prototype.getBirthdate=function(){return this.patientData.person.birthdate},Patient.prototype.getDead=function(){return this.patientData.person.dead},Patient.prototype.getDeathDate=function(){return this.patientData.person.deathDate},Patient.prototype.getGender=function(){return this.patientData.person.gender},Patient.prototype.getIdentifiers=function(){return this.patientData.identifiers},Patient.prototype.getPhoneNumber=function(){for(var a in this.patientData.person.attributes){var b=this.patientData.person.attributes[a];if("72a759a8-1359-11df-a1f1-0026b9348838"==b.attributeType.uuid)return b.value}},Patient.prototype.getClinicalHome=function(){for(var a in this.patientData.person.attributes){var b=this.patientData.person.attributes[a];if("8d87236c-c2cc-11de-8d13-0010c6dffd0f"==b.attributeType.uuid)return b.value}return""},Patient.prototype.getAttributes=function(){return this.patientData.person.attributes},Patient.prototype.setAttributes=function(a){var b,c,d,e,f=this.getAttributes();for(var g in a){b=a[g],c={attributeType:{uuid:g},value:b},e=!1,console.log("finding: "+g);for(var h in f)if(d=f[h],d.attributeType.uuid===g){console.log("found attribute, resetting to new value"),e=!0,f[h]=c;break}e||f.push(c)}},openmrsServices.factory("Patient",["$resource",function(a){var b="custom:(uuid,identifiers:ref,person:(uuid,gender,birthdate,dead,deathDate,preferredName:(givenName,middleName,familyName),attributes:(uuid,value,attributeType:ref)))";return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/patient/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("PatientService",["$http","Patient",function(a,b){var c={};return c.Patient=function(a){return new Patient(a)},c.getName=function(){return"patient"},c.get=function(a,c){b.get({uuid:a},function(a){var b=new Patient(a);return c?c(b):b},function(a){c({online:!1,error:a})})},c.query=function(a,c,d){b.query(a,function(a){return c?void c(a):a},function(a){d({online:!1,error:a})})},c}]),openmrsServices.factory("Form",["$resource",function(a){var b="custom:(uuid,name,encounterType:(uuid,name))";return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/form/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("Obs",["$resource",function(a){var b="custom:(uuid,concept:(uuid,uuid),groupMembers,value:ref)";return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/obs/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("ObsService",["Obs","$http",function(a,b){
var c={};return c.update=function(b,c,d){var e=new a({uuid:b,value:c});e.$save(function(a){console.log(a)},function(a){d({online:!1,error:a})})},c.updateObsSet=function(a,b){var d;for(var e in a)d=a[e],console.log("updating obs: "+angular.toJson(d)),void 0!==d.value&&""!==d.value?c.update(d.uuid,d.value,b):c["void"](d.uuid,b)},c.updateGroupMembers=function(b,c,d){var e=new a({uuid:b,groupMembers:c});e.$save(function(a){console.log(a)},function(a){d({online:!1,error:a})})},c.get=function(b,c){a.get({uuid:b},function(a){c(a)},function(a){c({online:!1,error:a})})},c.addObs=function(a,c,d){var e=OPENMRS_CONTEXT_PATH+"/ws/rest/v1/obs/"+a;console.log(e),b.post(e,c).success(function(a){d(a),a.error&&console.log("EncounterService.submit() : error in rest response")}).error(function(a,b){console.log("EncounterService.submit() : error:"),d(a),console.log(a),console.log(b)})},c["void"]=function(b,c){a["delete"]({uuid:b}).$promise.then(function(a){return c?void c(a):a})},c.voidObs=function(a,b){for(var d in a){var e=a[d];c["void"](e,b)}},c}]),openmrsServices.factory("Encounter",["$resource",function(a){var b="custom:(uuid,encounterDatetime,patient:(uuid,uuid),form:(uuid,name),location:ref";return b+=",encounterType:ref,provider:ref,obs:(uuid,concept:(uuid,uuid),value:ref,groupMembers))",a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/encounter/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("EncounterService",["$http","Encounter",function(a,b){var c={};return c.getName=function(){return"encounter"},c.get=function(a,c){b.get({uuid:a},function(a){return c?c(a):a},function(a){c({online:!1,error:a})})},c.patientQuery=function(a,c){var d="custom:(uuid,encounterDatetime,patient:(uuid,uuid),form:(uuid,name),location:ref";d+=",encounterType:ref,provider:ref)",a.v=d,b.get(a).$promise.then(function(a){return c?c(a):a},function(a){c({online:!1,error:a})})},c.patientQueryWithObs=function(a,c){b.get(a).$promise.then(function(a){return c?c(a):a},function(a){c({online:!1,error:a})})},c.submit=function(b,c){var d=OPENMRS_CONTEXT_PATH+"/ws/rest/v1/encounter/";b.uuid&&(d+=b.uuid),delete b.uuid,a.post(d,b).success(function(a){c(a),a.error&&console.log("EncounterService.submit() : error in rest response")}).error(function(a){console.log("EncounterService.submit() : error:"),c(a),console.log(a)})},c}]),openmrsServices.factory("EncounterType",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/encountertype/:uuid",{uuid:"@uuid"},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("Location",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/location/:uuid",{uuid:"@uuid"},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("LocationService",["$http","Location",function(a,b){var c={};return c.getName=function(){return"location"},c.getAll=function(a){b.get().$promise.then(function(b){a(b.results)},function(b){a({online:!1,error:b})})},c}]),openmrsServices.factory("Concept",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/concept/:uuid",{uuid:"@uuid"},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("PersonAttribute",["$resource",function(a){return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/person/:personUuid/attribute/:uuid",{},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("PersonAttributeService",["PersonAttribute","$http",function(a){var b={};return b.get=function(){},b.save=function(b,c,d,e){var f=new a({attributeType:c,value:d});f.$save({personUuid:b},function(a){return e?e(a):a})},b}]),openmrsServices.factory("OpenmrsUser",["$resource",function(a){var b="custom:(uuid,username,systemId,roles:(uuid,name,privileges))";return a(OPENMRS_CONTEXT_PATH+"/ws/rest/v1/user/:uuid",{uuid:"@uuid",v:b},{query:{method:"GET",isArray:!1}})}]),openmrsServices.factory("OpenmrsUserService",["OpenmrsUser",function(a){var b={};return b.getRoles=function(b,c){a.get({username:b}).$promise.then(function(a){return c?void c(a.results[0].roles):a.roles},function(a){c({online:!1,error:a})})},b.hasRole=function(b,c,d){a.get({username:b},function(a){var b=!1,e=a.results[0].roles;if(e)for(var f in e)if(e[f].uuid===c||e[f].name.toLowerCase()===c.toLowerCase()){b=!0;break}return d?void d(b):b},function(a){d({online:!1,error:a})})},b}]),angular.module("patientDashboard",["openmrsServices","flex","utility.widgets"]).directive("encountersPane",["$state","EncounterService","OpenmrsUtilityService",function(a,b,c){return{restrict:"E",scope:{patientUuid:"@"},controller:["$scope","$state",function(a,b){a.encounters=[],a.busy=!1,a.nextStartIndex=-1,a.showEncounter=function(c,d){for(var e in a.encounters)a.encounters[e].uuid===c&&(d=a.encounters[e].form.uuid);b.go("formentry",{encounterUuid:c,patientUuid:a.patientUuid,formUuid:d})}}],link:function(a,d,e){e.$observe("patientUuid",function(b){b&&""!=b&&(a.busy=!1,a.allDataLoaded=!1,a.nextStartIndex=0,a.encounters=[],a.loadMore())}),a.loadMore=function(){if(a.busy!==!0){a.busy=!0;var d={startIndex:a.nextStartIndex,patient:a.patientUuid,limit:20};b.patientQuery(d,function(b){a.nextStartIndex=c.getStartIndex(b);for(var d in b.results)a.encounters.push(b.results[d]);void 0!==a.nextStartIndex?a.busy=!1:a.allDataLoaded=!0})}}},templateUrl:"views/patient-dashboard/encountersPane.html"}}]).directive("formsPane",["FormEntryService",function(a){return{restrict:"E",scope:{patientUuid:"@"},controller:["$scope",function(b){b.forms=a.getForms()}],link:function(){},templateUrl:"views/patient-dashboard/formsPane.html"}}]);var pd=angular.module("patientDashboard");pd.controller("PatientDashboardCtrl",["$scope","$stateParams","Auth","Flex","PatientService","$timeout",function(a,b,c,d,e,f){a.patient={},a.p=null,f(function(){d.get(e,b.uuid,!0,c.getPassword(),function(b){var c=e.Patient(b.patientData);a.patient=c})})}]);var mod=angular.module("patientSearch",["openmrsServices","flex"]);mod.controller("PatientSearchCtrl",["$scope","PatientService","Flex",function(a,b,c){a.filter="",a.patients=[],a.$watch("searchString",function(d){var e="custom:(uuid,";e+="person:(uuid,gender,birthdate,preferredName:(givenName,middleName,familyName),birthdate,attributes:(attributeType:(uuid),uuid)))",d&&d.length>3&&c.query(b,d,null,!1,null,function(b){a.patients=b.results})})}]),angular.module("utility.widgets",[]).directive("backButton",[function(){return{restrict:"A",link:function(a,b){function c(){history.back(),a.$apply()}b.bind("click",c)}}}]).directive("checklistModel",["$parse","$compile",function(a,b){function c(a,b){if(angular.isArray(a))for(var c=0;c<a.length;c++)if(angular.equals(a[c],b))return!0;return!1}function d(a,b){"string"==typeof a&&(a=[a]),a=angular.isArray(a)?a:[];for(var c=0;c<a.length;c++)if(angular.equals(a[c],b))return a;return a.push(b),a}function e(a,b){if(angular.isArray(a))for(var c=0;c<a.length;c++)if(angular.equals(a[c],b)){a.splice(c,1);break}return a}function f(f,g,h){b(g)(f);var i=a(h.checklistModel),j=i.assign,k=h.checklistValue;f.$watch("checked",function(a,b){if(a!==b){var c=i(f.$parent);a===!0?j(f.$parent,d(c,k)):j(f.$parent,e(c,k))}}),f.$parent.$watch(h.checklistModel,function(a){"string"==typeof a&&j(f.$parent,[a]),f.checked=c(a,k)},!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,controller:["$scope","$element",function(){}],compile:function(a,b){if("INPUT"!==a[0].tagName||!a.attr("type","checkbox"))throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!b.checklistValue)throw"You should provide `checklist-value`.";return a.removeAttr("checklist-model"),a.attr("ng-model","checked"),f}}}]);var app=angular.module("spinner",[]);app.controller("controlPanel",["$scope","spinnerService",function(a,b){a.spinnerService=b}]),app.factory("spinnerService",function(){var a={};return{_register:function(b){if(!b.id)throw new Error("A spinner must have an ID to register with the spinner service.");a[b.id]=b},_unregister:function(b){delete a[b]},_unregisterGroup:function(b){for(var c in a)a.hasOwnProperty(c)&&a[c].group===b&&delete a[c]},_unregisterAll:function(){for(var b in a)a.hasOwnProperty(pinnerId)&&delete a[b]},show:function(b,c){if(a.hasOwnProperty(b)){var d=a[b];d.showSpinner=!0,void 0!==c&&(d.loadingText=c)}},hide:function(b,c){if(a.hasOwnProperty(b)){var d=a[b];d.showSpinner=!1,void 0!==c&&(d.doneText=c)}},showGroup:function(b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];e.group===b&&this.show(d,c)}},hideGroup:function(b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];e.group===b&&this.hide(d,c)}},showAll:function(b){for(var c in a)a.hasOwnProperty(c)&&this.show(c,b)},hideAll:function(b){for(var c in a)a.hasOwnProperty(c)&&this.hide(c,b)}}}),app.directive("spinner",function(){return{restrict:"E",template:["<span>",'  <img ng-show="showSpinner" ng-src="app/bower_components/ng-spinner/blue-spinner.gif" class="loading" />','  <span ng-show="loadingText && showSpinner">{{ loadingText }}</span>','  <span ng-show="doneText && !showSpinner">{{ doneText }}</span>',"</span>"].join(""),replace:!0,scope:{id:"@",group:"@?",showSpinner:"@?",loadingText:"@?",doneText:"@?",onRegisterComplete:"&?",url:"@"},controller:["$scope","$attrs","spinnerService",function(a,b,c){c._register(a),a.onRegisterComplete({$spinnerService:c})}],link:function(a,b,c){switch(c.hasOwnProperty("size")&&(c.size=c.size.toLowerCase()),c.size){case"tiny":a.spinnerSize="15px";break;case"small":a.spinnerSize="25px";break;case"medium":a.spinnerSize="35px";break;case"large":a.spinnerSize="75px";break;default:a.spinnerSize="50px"}}}}),angular.module("spinner").directive("spinner",[function(){return{restrict:"E",controller:["$scope",function(){}],link:function(){},templateUrl:"views/spinner/spinner.html"}}]);